apiVersion: apps/v1
kind: Deployment
metadata:
   name: csye7125-webapp
   labels:
     "app" : "webapp"
spec:
  replicas: 3
  selector:
    matchLabels:
      app: "webapp"
  template:
      metadata:
       labels:
        app: webapp
      spec:
        containers:
        - name: csye7125-webapp
          image: sumanthksai/group-csye7125:latest
          env:
            - name: DB_USERNAME
              value: "postgres"
            - name: DB_PASSWORD
              value: "password"
            - name: DB_NAME
              value: "postgres"
            - name: DB_HOST
              value: "host.docker.internal"
            - name: DB_PORT
              value: "5432"
            - name: APP_PORT
              value: "4000"
          ports:
          - containerPort: 4000
        initContainers:
        - name: flyway-migrate
          image: sumanthksai/flyway:1.2
          command: ["flyway","migrate", "-configFiles=/flyway/conf/flyway.config" ,"-locations=filesystem:/flyway/sql" , "-connectRetries=60"] 

    

    
  